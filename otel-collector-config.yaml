receivers:
  # Receive logs from the app via OTLP
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

  # Read Docker container logs directly
  filelog:
    include:
      - /var/lib/docker/containers/*/*.log
    operators:
      - type: json_parser
        timestamp:
          parse_from: attributes.time
          layout: '%Y-%m-%dT%H:%M:%S.%LZ'
      - type: move
        from: attributes.log
        to: body
      - type: move
        from: attributes.stream
        to: attributes["log.iostream"]

processors:
  batch:
    timeout: 5s
    send_batch_size: 100

  # Add resource attributes
  resource:
    attributes:
      - key: service.name
        value: learn-language
        action: upsert

exporters:
  # Export to file with rotation
  file:
    path: /logs/otel-logs.json
    rotation:
      max_megabytes: 100
      max_days: 7
      max_backups: 3

  # Also output to console for debugging
  debug:
    verbosity: basic

service:
  pipelines:
    logs:
      receivers: [otlp, filelog]
      processors: [batch, resource]
      exporters: [file, debug]
